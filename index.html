<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SupremeAmer Coin - Complete Mining Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff9800;
            --secondary-color: #fdc500;
            --accent-color: #ff3333;
            --dark-bg: #111;
            --light-bg: #fffde4;
            --text-dark: #fff;
            --text-light: #333;
            --card-bg-dark: rgba(30, 30, 40, 0.95);
            --card-bg-light: rgba(255,255,255,0.90);
            --success-color: #4CAF50;
            --warning-color: #ffc107;
            --info-color: #2196F3;
            --header-height: 80px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Montserrat', Arial, sans-serif;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, var(--dark-bg) 70%, var(--primary-color) 100%);
            color: var(--text-dark);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            padding-top: var(--header-height);
        }

        body.light {
            background: linear-gradient(135deg, var(--light-bg) 60%, #f7b733 100%);
            color: var(--text-light);
        }

        /* Enhanced Header Styles */
        .header {
            width: 100%;
            height: var(--header-height);
            padding: 0 20px;
            background: linear-gradient(90deg, rgba(0,0,0,0.9) 0%, rgba(30,30,40,0.9) 100%);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.3);
            position: fixed;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--primary-color);
        }

        body.light .header {
            background: linear-gradient(90deg, rgba(255,255,255,0.95) 0%, rgba(240,240,245,0.95) 100%);
            border-bottom: 2px solid var(--secondary-color);
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            font-size: 2.5em;
            color: var(--primary-color);
            filter: drop-shadow(0 0 5px rgba(255, 152, 0, 0.5));
        }

        .header-title {
            font-size: 1.8em;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            letter-spacing: 1px;
        }

        body.light .header-title {
            text-shadow: 0 2px 4px rgba(255, 255, 255, 0.5);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Enhanced Profile Dropdown */
        .profile-container {
            position: relative;
        }

        .profile-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #222;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 152, 0, 0.3);
        }

        .profile-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(255, 152, 0, 0.5);
        }

        .profile-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 60px;
            background: rgba(40, 40, 50, 0.95);
            min-width: 220px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1001;
            color: #fff;
            font-size: 1em;
            animation: fadeIn 0.3s;
            text-align: left;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        body.light .profile-dropdown {
            background: rgba(255, 255, 255, 0.95);
            color: #222;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(-10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .profile-header {
            padding: 15px 20px;
            background: rgba(255, 152, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.light .profile-header {
            background: rgba(255, 152, 0, 0.1);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .profile-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-email {
            font-size: 0.9em;
            color: var(--secondary-color);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        body.light .profile-email {
            color: #666;
        }

        .profile-menu {
            padding: 10px 0;
        }

        .profile-menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: inherit;
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .profile-menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        body.light .profile-menu-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .profile-menu-item i {
            width: 20px;
            text-align: center;
            color: var(--primary-color);
        }

        .profile-divider {
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 8px 0;
        }

        body.light .profile-divider {
            background: rgba(0, 0, 0, 0.1);
        }

        /* Marquee */
        .marquee {
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--primary-color));
            color: #222;
            font-size: 1.1em;
            padding: 10px 0;
            white-space: nowrap;
            overflow: hidden;
            position: relative;
            width: 100%;
            z-index: 999;
            font-weight: 600;
        }

        .marquee-text {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 20s linear infinite;
        }

        @keyframes marquee {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Main Container */
        .container {
            background: var(--card-bg-dark);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 450px;
            width: 90%;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            z-index: 1;
            margin: 20px 0 100px 0;
        }

        .container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 184, 0, 0.1) 0%, transparent 70%);
            z-index: -1;
            animation: rotate 60s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        body.light .container {
            background: var(--card-bg-light);
            color: var(--text-light);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        /* Coin Logo */
        .logo-container {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .coin-logo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
            z-index: 2;
            position: relative;
            border: 4px solid var(--primary-color);
            transition: all 0.3s;
            animation: pulse 2s infinite;
        }

        .coin-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.6);
        }

        /* Stats Display */
        .mined-coins {
            font-size: 2.5em;
            margin: 20px 0;
            color: var(--secondary-color);
            font-weight: 800;
            letter-spacing: 1px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .timer {
            font-size: 1.6em;
            color: var(--accent-color);
            margin-bottom: 20px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px 15px;
            border-radius: 10px;
            background: rgba(255, 51, 51, 0.1);
            display: inline-block;
        }

        .timer:hover {
            background: rgba(255, 51, 51, 0.2);
            transform: scale(1.05);
        }

        /* Buttons */
        .mine-btn, .withdraw-btn {
            padding: 16px 40px;
            background: linear-gradient(90deg, var(--secondary-color) 40%, var(--primary-color) 100%);
            color: #111;
            border: none;
            border-radius: 12px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .mine-btn:hover, .withdraw-btn:hover {
            background: linear-gradient(90deg, var(--primary-color) 40%, var(--secondary-color) 100%);
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.6);
            transform: translateY(-3px);
        }

        .mine-btn:active, .withdraw-btn:active {
            transform: translateY(0);
        }

        .withdraw-btn[disabled] {
            opacity: 0.65;
            cursor: not-allowed;
            background: #ccc;
            box-shadow: none;
        }

        .withdraw-btn[disabled]:hover {
            transform: none;
        }

        .upgrade-btn {
            padding: 14px 30px;
            background: linear-gradient(90deg, #ece9e6 0%, var(--primary-color) 100%);
            color: #222;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(255, 185, 0, 0.3);
            transition: all 0.3s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .upgrade-btn:hover {
            background: linear-gradient(90deg, #ffe259, #ffa751);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 185, 0, 0.5);
        }

        /* Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: var(--primary-color);
            border-radius: 50%;
            opacity: 0.3;
            animation: float linear infinite;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(-100vh) rotate(360deg); }
        }

        /* Upgrade Modal */
        .upgrade-modal {
            display: none;
            position: fixed;
            z-index: 2002;
            left: 0; 
            top: 0; 
            width: 100vw; 
            height: 100vh;
            background: rgba(0,0,0,0.7);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s;
        }

        .upgrade-modal-content {
            background: #fff;
            color: #222;
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            transform: scale(0.95);
            animation: modalAppear 0.3s forwards;
        }

        @keyframes modalAppear {
            to { transform: scale(1); }
        }

        .close-btn {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 1.5em;
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .close-btn:hover {
            transform: rotate(90deg);
        }

        .upgrade-plan {
            margin: 20px 0 15px 0;
            padding: 20px 15px;
            border-radius: 15px;
            background: #fffbe6;
            color: #333;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            transition: all 0.3s;
            border: 2px solid rgba(255, 152, 0, 0.2);
        }

        .upgrade-plan:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
        }

        .plan-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .plan-desc {
            font-size: 1em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .plan-action {
            margin-top: 15px;
        }

        /* Payment Processing Modal */
        .payment-modal {
            display: none;
            position: fixed;
            z-index: 2003;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .payment-modal-content {
            background: var(--card-bg-dark);
            color: var(--text-dark);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90vw;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
        }

        body.light .payment-modal-content {
            background: var(--card-bg-light);
            color: var(--text-light);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 20px 0;
            background: rgba(255, 184, 0, 0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            border-radius: 25px 25px 0 0;
            box-shadow: 0 -5px 20px rgba(255, 152, 0, 0.2);
            z-index: 999;
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-btn {
            background: #fff;
            color: var(--primary-color);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(34, 34, 34, 0.15);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }

        .footer-btn:hover {
            background: var(--primary-color);
            color: #fff;
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(255, 152, 0, 0.4);
        }

        .footer-btn.active {
            background: var(--primary-color);
            color: #fff;
        }

        .tooltip {
            position: absolute;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: #fff;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s;
            font-weight: 600;
        }

        .footer-btn:hover .tooltip {
            opacity: 1;
            bottom: 75px;
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary-color), var(--primary-color));
            border-radius: 10px;
            transition: width 0.5s;
            box-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: #333;
            color: #fff;
            padding: 18px 25px;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            transform: translateX(200%);
            transition: transform 0.4s;
            display: flex;
            align-items: center;
            gap: 15px;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success-color);
        }

        .notification.error {
            background: var(--accent-color);
        }

        .notification.info {
            background: var(--info-color);
        }

        /* Stats Panel */
        .stats-panel {
            background: var(--card-bg-dark);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        body.light .stats-panel {
            background: var(--card-bg-light);
        }

        .stat-item {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 15px 10px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        body.light .stat-item {
            background: rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 1.6em;
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-dark);
            font-weight: 600;
        }

        body.light .stat-label {
            color: var(--text-light);
        }

        /* Session Info */
        .session-info {
            background: var(--card-bg-dark);
            padding: 15px 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-left: 5px solid var(--primary-color);
        }

        body.light .session-info {
            background: var(--card-bg-light);
        }

        .session-status {
            font-weight: bold;
            color: var(--secondary-color);
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        /* Claim Status */
        .claim-status, .withdraw-status {
            margin: 7px 0 0 0;
            color: var(--secondary-color);
            font-size: 0.97em;
            min-height: 18px;
            transition: all 0.3s;
        }

        .success-message {
            color: #4CAF50;
            font-weight: bold;
        }

        .error-message {
            color: var(--accent-color);
            font-weight: bold;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 2s infinite;
        }

        /* Confetti */
        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            background-color: #f00;
            opacity: 0;
            z-index: 2001;
            animation: confetti-fall 3s linear forwards;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 0 15px;
                height: 80px;
            }

            .header-title {
                font-size: 1.5em;
            }

            .logo-icon {
                font-size: 2em;
            }

            .profile-btn {
                width: 45px;
                height: 45px;
                font-size: 1.3em;
            }

            .container {
                padding: 25px 20px;
                margin: 15px 0 100px 0;
            }

            .mined-coins {
                font-size: 2em;
            }

            .footer-btn {
                width: 50px;
                height: 50px;
                font-size: 1.3em;
            }

            .stats-panel {
                flex-direction: column;
            }

            .stat-item {
                min-width: 100%;
            }
        }

        @media (max-width: 480px) {
            .header-title {
                font-size: 1.3em;
            }

            .logo-icon {
                font-size: 1.8em;
            }

            .container {
                padding: 20px 15px;
            }

            .mined-coins {
                font-size: 1.8em;
            }

            .mine-btn, .withdraw-btn, .upgrade-btn {
                padding: 14px 20px;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <!-- Notification System -->
    <div class="notification">
        <i class="fas fa-check-circle"></i>
        <span class="notification-text">Notification message</span>
    </div>

    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Enhanced Header -->
    <header class="header">
        <div class="logo-section">
            <div class="logo-icon">üöÄ</div>
            <h1 class="header-title">SUPREMEAMER COIN</h1>
        </div>

        <div class="header-actions">
            <div class="profile-container">
                <button class="profile-btn" id="profileDropdownBtn">
                    <i class="fas fa-user"></i>
                </button>
                <div class="profile-dropdown" id="profileDropdownMenu">
                    <div class="profile-header">
                        <div class="profile-name">
                            <i class="fas fa-user-circle"></i>
                            <span id="dropdownUsername">Miner123</span>
                        </div>
                        <div class="profile-email">
                            <i class="fas fa-envelope"></i>
                            <span id="dropdownEmail">miner@example.com</span>
                        </div>
                    </div>
                    <div class="profile-menu">
                        <div class="profile-menu-item" id="themeToggleBtn">
                            <i class="fas fa-moon"></i>
                            <span>Dark Mode</span>
                        </div>
                        <div class="profile-divider"></div>
                        <div class="profile-menu-item">
                            <i class="fas fa-cog"></i>
                            <span>Settings</span>
                        </div>
                        <div class="profile-menu-item" id="refreshDataBtn">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh Data</span>
                        </div>
                        <div class="profile-divider"></div>
                        <div class="profile-menu-item">
                            <i class="fas fa-question-circle"></i>
                            <span>Help & Support</span>
                        </div>
                        <div class="profile-divider"></div>
                        <div class="profile-menu-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Marquee -->
    <div class="marquee">
        <div class="marquee-text">üöÄ Welcome to $SA - Mine SupremeAmer coins and join the revolution! üí∞ Withdrawals on 9th & 13th each month üéâ</div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <div style="font-size:1.6em; color:var(--secondary-color); margin-bottom:10px; font-weight:700;">Mining Dashboard</div>

        <div class="logo-container">
            <img class="coin-logo" src="https://via.placeholder.com/120" alt="SupremeAmer Coin">
        </div>

        <div class="mined-coins" id="minedCoins">0 SA</div>

        <!-- Session Info -->
        <div class="session-info">
            <div class="session-status" id="sessionStatus">Ready to start mining</div>
            <div id="sessionTime">Session: 00:00:00 / 07:00:00</div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="stat-item">
                <div class="stat-value" id="miningRate">0.0002</div>
                <div class="stat-label">SA/sec</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="sessionProgress">0%</div>
                <div class="stat-label">Progress</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="multiplier">1x</div>
                <div class="stat-label">Multiplier</div>
            </div>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
            <div class="progress-bar" id="miningProgress"></div>
        </div>

        <div class="timer" id="timer">07:00:00</div>

        <button class="mine-btn" id="mineBtn">
            <i class="fas fa-play"></i>
            <span id="mineBtnText">Start Mining</span>
        </button>

        <button class="upgrade-btn" id="showUpgradeBtn">
            <i class="fas fa-bolt"></i>
            <span>Upgrade Mining</span>
        </button>

        <button class="withdraw-btn" id="withdrawBtn">
            <i class="fas fa-wallet"></i>
            <span>Withdraw (Min: 50,000 SA)</span>
        </button>

        <div class="claim-status" id="claimStatus"></div>
        <div class="withdraw-status" id="withdrawStatus"></div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <button class="footer-btn" onclick="window.location.href='index.html'">
            <i class="fas fa-home"></i>
            <span class="tooltip">Home</span>
        </button>
        <button class="footer-btn" onclick="window.location.href='Task.html'">
            <i class="fas fa-tasks"></i>
            <span class="tooltip">Tasks</span>
        </button>
        <button class="footer-btn" onclick="window.location.href='wallet.html'">
            <i class="fas fa-wallet"></i>
            <span class="tooltip">Wallet</span>
        </button>
        <button class="footer-btn" onclick="window.location.href='dapp.html'">
            <i class="fas fa-gamepad"></i>
            <span class="tooltip">DApp</span>
        </button>
    </div>

    <!-- Upgrade Modal -->
    <div class="upgrade-modal" id="upgradeModal">
        <div class="upgrade-modal-content">
            <button class="close-btn" id="closeUpgradeModal">&times;</button>
            <h3 style="color:var(--primary-color);margin-top:0; font-size:1.5em;">Upgrade Mining Speed</h3>

            <div class="upgrade-plan">
                <div class="plan-title">üöÄ 0.05 SA/sec</div>
                <div class="plan-desc">Duration: <b>360 days</b> <br> Fee: <b>0.002 BNB</b> <br> Claim every 30 days</div>
                <div class="plan-action">
                    <button class="upgrade-btn" style="padding:10px 20px;" onclick="upgradeMiningWithPaymentIntent('0.05')">
                        <i class="fas fa-bolt"></i>Upgrade
                    </button>
                </div>
            </div>

            <div class="upgrade-plan">
                <div class="plan-title">üî• 0.1 SA/sec</div>
                <div class="plan-desc">Duration: <b>360 days</b> <br> Fee: <b>0.009 BNB</b> <br> Claim every 30 days</div>
                <div class="plan-action">
                    <button class="upgrade-btn" style="padding:10px 20px;" onclick="upgradeMiningWithPaymentIntent('0.1')">
                        <i class="fas fa-fire"></i>Upgrade
                    </button>
                </div>
            </div>

            <div style="font-size:0.95em;color:#666;margin-top:15px; line-height:1.5;">
               After upgrade, mining speed increases for 360 days. You can claim mined rewards every 30 days. Mining continues even if you delay claim, but only for 360 days.
            </div>
        </div>
    </div>

    <!-- Payment Processing Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="payment-modal-content">
            <button class="close-btn" id="closePaymentModal">&times;</button>
            <h3 style="color:var(--secondary-color); margin-bottom:20px;" id="paymentTitle">Processing Payment</h3>
            
            <div class="loading-spinner"></div>
            <p id="paymentMessage">Please confirm the transaction in your wallet...</p>
            
            <div style="margin-top:20px; background:rgba(255,255,255,0.1); padding:15px; border-radius:10px;">
                <div style="font-family:monospace; font-size:0.9em; word-break:break-all;" id="transactionHash"></div>
                <button class="upgrade-btn" style="margin-top:10px; width:100%;" id="copyTxHashBtn">
                    <i class="fas fa-copy"></i> Copy Transaction Hash
                </button>
            </div>
            
            <div style="margin-top:20px; display:none;" id="verificationStatus">
                <p><i class="fas fa-spinner fa-spin"></i> Verifying on blockchain...</p>
                <div class="loading-spinner" style="width:20px; height:20px; margin:10px auto;"></div>
            </div>
        </div>
    </div>

    <!-- Confetti Container -->
    <div id="confettiContainer"></div>

    <!-- Supabase & Ethers -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5/dist/ethers.umd.min.js"></script>
    <script>
// ---- CONFIGURATION ----
const SUPABASE_URL = 'https://your-project.supabase.co'; // Replace with your Supabase URL
const SUPABASE_ANON_KEY = 'your-anon-key'; // Replace with your Supabase anon key

const SUPREMEAMER_RECEIVER_BNB = '0xYourBnbAddressHere'; // REPLACE WITH YOUR BNB ADDRESS

const UPGRADE_FEES = {
    "0.05": "0.002",
    "0.1": "0.009"
};
const UPGRADE_SPEEDS = {
    "0.05": 0.05,
    "0.1": 0.1
};
const NORMAL_SPEED = 0.0002;
const UPGRADE_DURATION = 360 * 24 * 3600;
const CLAIM_INTERVAL = 30 * 24 * 3600;
const WITHDRAW_ELIGIBILITY_FEE_BNB = "0.0017";
const WITHDRAW_MIN_SA = 50000;
const WITHDRAW_FEE_PERCENT = 6;
const WITHDRAW_DAYS = [9, 13];
const SESSION_DURATION = 7 * 60 * 60;

// Initialize Supabase
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// User state
let currentUser = null;
let userProfile = null;
let supabaseUserId = null;

// Mining state
let minedCoins = 0;
let miningActive = false;
let miningStartTime = 0;
let miningSpeed = NORMAL_SPEED;
let miningMultiplier = 1;
let sessionDuration = SESSION_DURATION;
let miningInterval;

// Upgrade state
let miningUpgrade = null;
let upgradeActive = false;

// Background mining state
let backgroundMiningData = null;

// ---- AUTHENTICATION & USER MANAGEMENT ----

// Check authentication and load user data
async function initializeApp() {
    try {
        // Check Supabase session
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();
        
        if (sessionError) throw sessionError;
        
        if (!session) {
            // No session, redirect to login
            throw new Error('No session found');
        }
        
        currentUser = session.user;
        supabaseUserId = currentUser.id;
        
        console.log("‚úÖ User authenticated:", currentUser.email);

        // Set authentication flag
        localStorage.setItem('isLoggedIn', 'true');
        localStorage.setItem('userId', supabaseUserId);
        localStorage.setItem('userEmail', currentUser.email);

        // Load user profile from Supabase
        await loadUserProfile();

        // Load mining data for this user
        await loadUserMiningData();

        // Sync upgrades from Supabase
        await syncUserUpgrades();

        // Initialize UI
        initializeUI();

        // Show welcome message
        showNotification(`Welcome back, ${userProfile?.name || currentUser.email || 'Miner'}!`, "success");

    } catch (error) {
        console.error("‚ùå Authentication failed:", error);
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userId');
        localStorage.removeItem('userEmail');
        showNotification("Please login to continue", "error");
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 2000);
        return;
    }
}

// Load user profile from Supabase
async function loadUserProfile() {
    try {
        const { data, error } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', supabaseUserId)
            .single();
        
        if (error) {
            // Profile might not exist yet, create one
            if (error.code === 'PGRST116') {
                const { data: newProfile, error: createError } = await supabase
                    .from('profiles')
                    .insert({
                        id: supabaseUserId,
                        email: currentUser.email,
                        name: currentUser.email.split('@')[0],
                        wallet_address: null,
                        last_upgrade: null,
                        created_at: new Date().toISOString()
                    })
                    .select()
                    .single();
                
                if (createError) throw createError;
                
                userProfile = newProfile;
                console.log("‚úÖ Created new user profile:", userProfile);
            } else {
                throw error;
            }
        } else {
            userProfile = data;
            console.log("‚úÖ User profile loaded:", userProfile);
        }
    } catch (error) {
        console.error("‚ùå Error loading user profile:", error);
        // Use basic user info as fallback
        userProfile = {
            name: currentUser.email.split('@')[0],
            email: currentUser.email,
            wallet_address: null
        };
    }
}

// Load user-specific mining data
async function loadUserMiningData() {
    if (!supabaseUserId) {
        console.error("‚ùå No current user found");
        return;
    }
    
    console.log("üìä Loading mining data for user:", supabaseUserId);

    // Load from localStorage with user-specific keys
    minedCoins = parseFloat(localStorage.getItem(`minedCoins_${supabaseUserId}`)) || 0;
    miningActive = localStorage.getItem(`miningActive_${supabaseUserId}`) === 'true';
    miningStartTime = parseInt(localStorage.getItem(`miningStartTime_${supabaseUserId}`)) || 0;
    miningSpeed = parseFloat(localStorage.getItem(`miningSpeed_${supabaseUserId}`)) || NORMAL_SPEED;
    miningMultiplier = parseInt(localStorage.getItem(`miningMultiplier_${supabaseUserId}`)) || 1;

    // Load upgrade data
    const upgradeData = localStorage.getItem(`miningUpgrade_${supabaseUserId}`);
    miningUpgrade = upgradeData ? JSON.parse(upgradeData) : null;

    // Load background mining data
    const bgData = localStorage.getItem(`backgroundMining_${supabaseUserId}`);
    backgroundMiningData = bgData ? JSON.parse(bgData) : null;

    console.log("‚úÖ Mining data loaded for user:", supabaseUserId);
}

// Save user-specific mining data
function saveUserMiningData() {
    if (!supabaseUserId) return;

    localStorage.setItem(`minedCoins_${supabaseUserId}`, minedCoins.toString());
    localStorage.setItem(`miningActive_${supabaseUserId}`, miningActive.toString());
    localStorage.setItem(`miningStartTime_${supabaseUserId}`, miningStartTime.toString());
    localStorage.setItem(`miningSpeed_${supabaseUserId}`, miningSpeed.toString());
    localStorage.setItem(`miningMultiplier_${supabaseUserId}`, miningMultiplier.toString());

    if (miningUpgrade) {
        localStorage.setItem(`miningUpgrade_${supabaseUserId}`, JSON.stringify(miningUpgrade));
    }
}

// Enhanced logout function
async function handleLogout() {
    try {
        // Save current state before logout
        saveUserMiningData();

        // Sign out from Supabase
        const { error } = await supabase.auth.signOut();
        if (error) throw error;

        // Clear user-specific data
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userId');
        localStorage.removeItem('userEmail');

        showNotification("Logged out successfully", "success");
        setTimeout(() => {
            window.location.href = 'login.html';
        }, 1000);
    } catch (err) {
        console.error("‚ùå Logout error:", err);
        // Force redirect even if logout fails
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userId');
        localStorage.removeItem('userEmail');
        window.location.href = 'login.html';
    }
}

// Initialize UI after authentication
function initializeUI() {
    // Update user information in dropdown
    const username = userProfile?.name || currentUser.email.split('@')[0] || 'Miner';
    const userEmail = currentUser.email;
    
    document.getElementById('dropdownUsername').textContent = username;
    document.getElementById('dropdownEmail').textContent = userEmail;

    // Check for background mining
    checkBackgroundMining();

    // Check for existing upgrade
    if (miningUpgrade) {
        const now = Math.floor(Date.now() / 1000);
        const upgradeEndTime = miningUpgrade.startTime + UPGRADE_DURATION;

        if (now < upgradeEndTime) {
            upgradeActive = true;
            miningSpeed = miningUpgrade.upgradeSpeed;
        } else {
            // Upgrade expired
            miningUpgrade = null;
            localStorage.removeItem(`miningUpgrade_${supabaseUserId}`);
            miningSpeed = NORMAL_SPEED;
            localStorage.setItem(`miningSpeed_${supabaseUserId}`, miningSpeed.toString());
        }
    }

    updateUI();

    // Resume mining if active
    if (miningActive) {
        resumeMining();
    }

    // Initialize with a welcome message
    setTimeout(() => {
        showNotification("Mining dashboard ready!", "info");
    }, 1000);
}

// Sync upgrades from Supabase
async function syncUserUpgrades() {
    try {
        console.log("üîÑ Syncing upgrades from Supabase...");
        
        const { data: activeUpgrades, error } = await supabase
            .from('user_upgrades')
            .select('*')
            .eq('user_id', supabaseUserId)
            .eq('status', 'active')
            .gt('valid_until', new Date().toISOString());
        
        if (error) throw error;
        
        if (activeUpgrades && activeUpgrades.length > 0) {
            // Get the highest speed upgrade
            const highestUpgrade = activeUpgrades.reduce((max, upgrade) => {
                const speed = parseFloat(upgrade.product_id.split('_')[1]);
                return speed > max.speed ? { speed, upgrade } : max;
            }, { speed: 0, upgrade: null });
            
            if (highestUpgrade.upgrade) {
                miningUpgrade = {
                    upgradeSpeed: highestUpgrade.speed,
                    startTime: Math.floor(new Date(highestUpgrade.purchased_at).getTime() / 1000),
                    validUntil: Math.floor(new Date(highestUpgrade.valid_until).getTime() / 1000),
                    transactionHash: highestUpgrade.purchase_tx_hash,
                    paymentIntentId: highestUpgrade.payment_intent_id
                };
                
                upgradeActive = true;
                miningSpeed = highestUpgrade.speed;
                
                // Save to localStorage
                localStorage.setItem(`miningSpeed_${supabaseUserId}`, miningSpeed.toString());
                localStorage.setItem(`miningUpgrade_${supabaseUserId}`, JSON.stringify(miningUpgrade));
                
                console.log(`‚úÖ Active upgrade loaded: ${miningSpeed} SA/sec`);
            }
        }
    } catch (error) {
        console.error("‚ùå Error syncing upgrades:", error);
    }
}

// Theme Toggle Functionality
const themeToggleBtn = document.getElementById('themeToggleBtn');
const themeIcon = themeToggleBtn.querySelector('i');
const themeText = themeToggleBtn.querySelector('span');

function setTheme(light) {
    if(light) {
        document.body.classList.add('light');
        localStorage.setItem('theme','light');
        themeIcon.className = 'fas fa-sun';
        themeText.textContent = 'Light Mode';
    } else {
        document.body.classList.remove('light');
        localStorage.setItem('theme','dark');
        themeIcon.className = 'fas fa-moon';
        themeText.textContent = 'Dark Mode';
    }
}

themeToggleBtn.onclick = function() {
    setTheme(!document.body.classList.contains('light'));
};

// On load, restore theme
if(localStorage.getItem('theme')==='light') setTheme(true);

// Profile Dropdown Functionality
document.getElementById('profileDropdownBtn').onclick = function(e) {
    e.stopPropagation();
    let menu = document.getElementById('profileDropdownMenu');
    menu.style.display = (menu.style.display === "block") ? "none" : "block";
};

document.addEventListener('click', function() {
    let menu = document.getElementById('profileDropdownMenu');
    if (menu.style.display === "block") menu.style.display = "none";
});

document.getElementById('profileDropdownMenu').onclick = function(e) { 
    e.stopPropagation(); 
};

// Refresh Data Functionality
document.getElementById('refreshDataBtn').onclick = async function(e) {
    e.preventDefault();
    showNotification("Refreshing data...", "info");
    
    try {
        await syncUserUpgrades();
        updateUI();
        showNotification("Data refreshed successfully!", "success");
    } catch (error) {
        console.error("Error refreshing data:", error);
        showNotification("Failed to refresh data", "error");
    }
};

// Logout Functionality
document.getElementById('logoutBtn').onclick = function(e) {
    e.preventDefault();
    handleLogout();
};

// Upgrade Modal Functionality
function showUpgradeModal() {
    document.getElementById('upgradeModal').style.display = 'flex';
}

function hideUpgradeModal() {
    document.getElementById('upgradeModal').style.display = 'none';
}

document.getElementById('showUpgradeBtn').onclick = showUpgradeModal;
document.getElementById('closeUpgradeModal').onclick = hideUpgradeModal;

// Payment Modal Functionality
function showPaymentModal(title, message) {
    document.getElementById('paymentTitle').textContent = title;
    document.getElementById('paymentMessage').textContent = message;
    document.getElementById('transactionHash').textContent = '';
    document.getElementById('verificationStatus').style.display = 'none';
    document.getElementById('paymentModal').style.display = 'flex';
}

function hidePaymentModal() {
    document.getElementById('paymentModal').style.display = 'none';
}

document.getElementById('closePaymentModal').onclick = hidePaymentModal;

// Close modals when clicking outside
document.getElementById('upgradeModal').onclick = function(e) {
    if (e.target === this) {
        hideUpgradeModal();
    }
};

document.getElementById('paymentModal').onclick = function(e) {
    if (e.target === this) {
        hidePaymentModal();
    }
};

// Copy Transaction Hash
document.getElementById('copyTxHashBtn').onclick = function() {
    const txHash = document.getElementById('transactionHash').textContent;
    if (txHash && txHash !== '') {
        navigator.clipboard.writeText(txHash).then(() => {
            showNotification("Transaction hash copied to clipboard!", "success");
        }).catch(err => {
            console.error('Failed to copy: ', err);
            showNotification("Failed to copy transaction hash", "error");
        });
    }
};

// Notification System
function showNotification(message, type = 'info', duration = 3000) {
    const notification = document.querySelector('.notification');
    const notificationText = document.querySelector('.notification-text');

    notificationText.textContent = message;
    notification.className = 'notification';

    // Add type class
    if (type === 'success') {
        notification.classList.add('success');
        notification.querySelector('i').className = 'fas fa-check-circle';
    } else if (type === 'error') {
        notification.classList.add('error');
        notification.querySelector('i').className = 'fas fa-exclamation-circle';
    } else {
        notification.classList.add('info');
        notification.querySelector('i').className = 'fas fa-info-circle';
    }

    // Show notification
    notification.classList.add('show');

    // Hide after duration
    setTimeout(() => {
        notification.classList.remove('show');
    }, duration);
}

// ---- PAYMENT INTENT SYSTEM ----

// Create payment intent in Supabase
async function createPaymentIntent(productId, expectedAmountBNB, type = 'upgrade', metadata = {}) {
    try {
        console.log(`üìù Creating payment intent for ${productId}: ${expectedAmountBNB} BNB`);
        
        // Check if wallet is connected
        if (typeof window.ethereum === 'undefined') {
            throw new Error('Please connect your BNB wallet first');
        }
        
        // Get wallet address
        const accounts = await window.ethereum.request({ method: 'eth_accounts' });
        if (accounts.length === 0) {
            throw new Error('Please connect your wallet first');
        }
        
        const walletAddress = accounts[0];
        
        // Generate unique intent ID
        const intentId = `intent_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        
        // Convert BNB to wei
        const expectedAmountWei = ethers.utils.parseEther(expectedAmountBNB).toString();
        
        // Create payment intent in Supabase
        const { data, error } = await supabase
            .from('payment_intents')
            .insert({
                id: intentId,
                user_id: supabaseUserId,
                wallet_address: walletAddress,
                product_id: productId,
                type: type,
                expected_amount_bnb: expectedAmountBNB,
                expected_amount_wei: expectedAmountWei,
                status: 'pending',
                network: 'BNB',
                chain_id: 56,
                receiver_address: SUPREMEAMER_RECEIVER_BNB,
                metadata: metadata,
                expires_at: new Date(Date.now() + (30 * 60 * 1000)).toISOString(),
                created_at: new Date().toISOString()
            })
            .select()
            .single();
        
        if (error) throw error;
        
        console.log('‚úÖ Payment intent created:', intentId);
        return {
            intentId: intentId,
            ...data
        };
        
    } catch (error) {
        console.error('‚ùå Error creating payment intent:', error);
        throw error;
    }
}

// Verify payment via Supabase Edge Function
async function verifyPayment(intentId, txHash) {
    try {
        console.log(`üîç Verifying payment: ${intentId}, ${txHash}`);
        
        // Show verification status
        document.getElementById('verificationStatus').style.display = 'block';
        document.getElementById('paymentMessage').textContent = 'Verifying transaction on blockchain...';
        
        // Call Supabase Edge Function for verification
        const { data, error } = await supabase.functions.invoke('verify-payment', {
            body: {
                paymentIntentId: intentId,
                txHash: txHash,
                userId: supabaseUserId
            }
        });
        
        if (error) throw error;
        
        if (data.success) {
            console.log('‚úÖ Payment verified successfully');
            
            // Hide payment modal after verification
            setTimeout(() => {
                hidePaymentModal();
                document.getElementById('verificationStatus').style.display = 'none';
            }, 2000);
            
            return data;
        } else {
            if (data.retry) {
                // Retry after delay
                console.log('‚è≥ Waiting for confirmations, retrying in 10 seconds...');
                document.getElementById('paymentMessage').textContent = `Waiting for confirmations (${data.message || '0/3'})...`;
                await new Promise(resolve => setTimeout(resolve, 10000));
                return await verifyPayment(intentId, txHash);
            }
            throw new Error(data.error || 'Payment verification failed');
        }
        
    } catch (error) {
        console.error('‚ùå Payment verification error:', error);
        document.getElementById('verificationStatus').style.display = 'none';
        throw error;
    }
}

// Upgrade Mining with Payment Intent
async function upgradeMiningWithPaymentIntent(speedKey) {
    if (!currentUser) {
        showNotification("Please login first", "error");
        return;
    }

    hideUpgradeModal();

    if (upgradeActive) {
        showNotification("You already have an active upgrade!", "error");
        return;
    }

    const upgradeAmount = UPGRADE_FEES[speedKey];
    const upgradeSpeed = UPGRADE_SPEEDS[speedKey];
    
    // Show confirmation
    const confirmed = confirm(`Upgrade mining speed to ${upgradeSpeed} SA/sec for 360 days?\n\nCost: ${upgradeAmount} BNB\n\nClick OK to create payment request.`);
    if(!confirmed) return;

    try {
        // Show payment modal
        showPaymentModal('Processing Upgrade Payment', 'Please confirm the transaction in your wallet...');

        // 1. Create payment intent
        const paymentIntent = await createPaymentIntent(
            `upgrade_${speedKey}_speed`,
            upgradeAmount,
            'upgrade',
            {
                speed: upgradeSpeed,
                duration_days: 360
            }
        );

        // 2. Send BNB transaction
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();

        const gasPrice = await provider.getGasPrice();
        const gasLimit = 21000;

        const tx = {
            to: SUPREMEAMER_RECEIVER_BNB,
            value: ethers.utils.parseEther(upgradeAmount),
            gasLimit: gasLimit,
            gasPrice: gasPrice
        };

        // 3. Send transaction
        const transaction = await signer.sendTransaction(tx);
        
        // Update payment modal with transaction hash
        document.getElementById('transactionHash').textContent = transaction.hash;
        document.getElementById('paymentMessage').textContent = 'Transaction submitted! Waiting for confirmation...';
        
        showNotification(`Transaction sent! Hash: ${transaction.hash.substring(0, 10)}...`, "info");
        
        // 4. Verify payment
        const verification = await verifyPayment(paymentIntent.intentId, transaction.hash);
        
        if (verification.success) {
            // 5. Update local state
            miningUpgrade = {
                upgradeSpeed: upgradeSpeed,
                bnbFee: upgradeAmount,
                startTime: Math.floor(Date.now() / 1000),
                validUntil: verification.validUntil,
                transactionHash: transaction.hash,
                paymentIntentId: paymentIntent.intentId
            };

            upgradeActive = true;
            miningSpeed = upgradeSpeed;

            localStorage.setItem(`miningSpeed_${supabaseUserId}`, miningSpeed.toString());
            localStorage.setItem(`miningUpgrade_${supabaseUserId}`, JSON.stringify(miningUpgrade));

            // Refresh upgrades display
            await syncUserUpgrades();
            
            updateUI();
            createConfetti();
            showNotification(`Mining upgraded to ${upgradeSpeed} SA/sec!`, "success");

        } else {
            throw new Error('Payment verification failed');
        }

    } catch (error) {
        console.error("‚ùå Upgrade error:", error);
        hidePaymentModal();
        showNotification("Upgrade failed: " + error.message, "error");
    }
}

// ---- MINING SYSTEM ----

// Check for background mining when page loads
function checkBackgroundMining() {
    if (backgroundMiningData) {
        const now = Math.floor(Date.now() / 1000);
        const elapsed = now - backgroundMiningData.lastUpdate;

        if (elapsed > 0) {
            // Calculate coins earned while offline
            const offlineCoins = elapsed * backgroundMiningData.speed * backgroundMiningData.multiplier;
            minedCoins += offlineCoins;
            saveUserMiningData();

            showNotification(`Earned ${offlineCoins.toFixed(4)} SA while offline!`, "success");
        }

        // Clear background mining data
        localStorage.removeItem(`backgroundMining_${supabaseUserId}`);
    }
}

// Save mining state when page is about to close
window.addEventListener('beforeunload', function() {
    if (miningActive && supabaseUserId) {
        localStorage.setItem(`backgroundMining_${supabaseUserId}`, JSON.stringify({
            lastUpdate: Math.floor(Date.now() / 1000),
            speed: miningSpeed,
            multiplier: miningMultiplier
        }));
    }
    saveUserMiningData();
});

// Mining functionality
function updateMining() {
    if (!miningActive || !currentUser) return;

    const now = Math.floor(Date.now() / 1000);
    const elapsed = now - miningStartTime;

    if (elapsed >= sessionDuration) {
        // Session completed
        stopMining();
        showNotification("Mining session completed!", "success");
        return;
    }

    // Calculate coins earned
    const coinsEarned = miningSpeed * miningMultiplier;
    minedCoins += coinsEarned;
    saveUserMiningData();

    // Update UI
    updateUI();
}

function startMining() {
    if (miningActive || !currentUser) return;

    miningActive = true;
    miningStartTime = Math.floor(Date.now() / 1000);

    saveUserMiningData();

    // Update UI
    document.getElementById('mineBtnText').textContent = 'Mining...';
    document.getElementById('mineBtn').querySelector('i').className = 'fas fa-cog fa-spin';
    document.getElementById('sessionStatus').textContent = 'Mining in progress...';

    // Start interval
    miningInterval = setInterval(updateMining, 1000);

    showNotification("Mining session started!", "success");
}

function stopMining() {
    miningActive = false;
    saveUserMiningData();

    // Update UI
    document.getElementById('mineBtnText').textContent = 'Start Mining';
    document.getElementById('mineBtn').querySelector('i').className = 'fas fa-play';
    document.getElementById('sessionStatus').textContent = 'Ready to start mining';

    // Clear interval
    clearInterval(miningInterval);
}

function resumeMining() {
    if (!miningActive || !currentUser) return;

    const now = Math.floor(Date.now() / 1000);
    const elapsed = now - miningStartTime;

    if (elapsed >= sessionDuration) {
        // Session completed while away
        stopMining();
        showNotification("Mining session completed!", "success");
        return;
    }

    // Update UI
    document.getElementById('mineBtnText').textContent = 'Mining...';
    document.getElementById('mineBtn').querySelector('i').className = 'fas fa-cog fa-spin';
    document.getElementById('sessionStatus').textContent = 'Mining in progress...';

    // Start interval
    miningInterval = setInterval(updateMining, 1000);
}

function updateUI() {
    // Update mined coins
    document.getElementById('minedCoins').textContent = `${minedCoins.toFixed(4)} SA`;

    // Update timer and progress
    if (miningActive) {
        const now = Math.floor(Date.now() / 1000);
        const elapsed = now - miningStartTime;
        const remaining = Math.max(sessionDuration - elapsed, 0);

        // Format time
        const hours = Math.floor(remaining / 3600);
        const minutes = Math.floor((remaining % 3600) / 60);
        const seconds = remaining % 60;

        document.getElementById('timer').textContent = 
            `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        // Update progress
        const progress = (elapsed / sessionDuration) * 100;
        document.getElementById('miningProgress').style.width = `${progress}%`;
        document.getElementById('sessionProgress').textContent = `${Math.round(progress)}%`;

        // Update session time
        const elapsedHours = Math.floor(elapsed / 3600);
        const elapsedMinutes = Math.floor((elapsed % 3600) / 60);
        const elapsedSeconds = elapsed % 60;

        document.getElementById('sessionTime').textContent = 
            `Session: ${elapsedHours.toString().padStart(2, '0')}:${elapsedMinutes.toString().padStart(2, '0')}:${elapsedSeconds.toString().padStart(2, '0')} / 07:00:00`;
    }

    // Update mining rate
    document.getElementById('miningRate').textContent = (miningSpeed * miningMultiplier).toFixed(4);

    // Update multiplier
    document.getElementById('multiplier').textContent = `${miningMultiplier}x`;

    // Update claim status
    updateClaimStatus();
}

function updateClaimStatus() {
    const claimStatus = document.getElementById('claimStatus');

    if (upgradeActive && miningUpgrade) {
        const now = Math.floor(Date.now() / 1000);
        const upgradeEndTime = miningUpgrade.validUntil || (miningUpgrade.startTime + UPGRADE_DURATION);
        const timeLeft = upgradeEndTime - now;
        const nextClaim = miningUpgrade.lastClaim + CLAIM_INTERVAL;
        const canClaim = now >= nextClaim;

        if (timeLeft > 0) {
            const daysLeft = Math.floor(timeLeft / (24 * 3600));
            const hoursLeft = Math.floor((timeLeft % (24 * 3600)) / 3600);

            claimStatus.innerHTML = `Upgrade: <b>${miningUpgrade.upgradeSpeed} SA/sec</b>, ${daysLeft}d ${hoursLeft}h left<br>
            Next claim: <b>${new Date(nextClaim * 1000).toLocaleDateString()}</b> ${canClaim ? '<span style="color:#00ffb3;">Ready!</span>' : ''}`;
        } else {
            // Upgrade expired
            upgradeActive = false;
            miningUpgrade = null;
            localStorage.removeItem(`miningUpgrade_${supabaseUserId}`);
            miningSpeed = NORMAL_SPEED;
            localStorage.setItem(`miningSpeed_${supabaseUserId}`, miningSpeed.toString());
            claimStatus.innerHTML = "";
            showNotification("Your mining upgrade has expired", "info");
        }
    } else {
        claimStatus.innerHTML = "";
    }
}

// Particles Background
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = window.innerWidth < 600 ? 30 : 50;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');

        // Random size between 2px and 6px
        const size = Math.random() * 4 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;

        // Random position
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 100}vh`;

        // Random color
        const colors = ['#ff9800', '#fdc500', '#ff3333', '#4CAF50', '#2196F3'];
        particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

        // Random animation duration
        const duration = Math.random() * 20 + 10;
        particle.style.animationDuration = `${duration}s`;

        // Random delay
        particle.style.animationDelay = `${Math.random() * 10}s`;

        particlesContainer.appendChild(particle);
    }
}

// Confetti Effect
function createConfetti() {
    const container = document.getElementById('confettiContainer');
    const colors = ['#ff9800', '#fdc500', '#ff3333', '#4CAF50', '#2196F3'];

    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');

        // Random position
        confetti.style.left = `${Math.random() * 100}vw`;

        // Random size
        const size = Math.random() * 10 + 5;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;

        // Random shape
        if (Math.random() > 0.5) {
            confetti.style.borderRadius = '50%';
        } else {
            confetti.style.borderRadius = '0';
        }

        // Random color
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];

        // Random animation duration
        const duration = Math.random() * 3 + 2;
        confetti.style.animationDuration = `${duration}s`;

        container.appendChild(confetti);

        // Remove after animation
        setTimeout(() => {
            confetti.remove();
        }, duration * 1000);
    }
}

// Mining button event
document.getElementById('mineBtn').onclick = function() {
    if (!currentUser) {
        showNotification("Please login first", "error");
        return;
    }

    if (miningActive) {
        stopMining();
        showNotification("Mining stopped", "info");
    } else {
        startMining();
    }
};

// Withdraw button event
document.getElementById('withdrawBtn').onclick = async function() {
    if (!currentUser) {
        showNotification("Please login first", "error");
        return;
    }

    const today = new Date();

    // Check if today is a withdrawal day
    if (!WITHDRAW_DAYS.includes(today.getDate())) {
        document.getElementById('withdrawStatus').textContent = `Withdrawals only on ${WITHDRAW_DAYS.join('th and ')}th each month!`;
        document.getElementById('withdrawStatus').classList.add('error-message');
        return;
    }

    if (minedCoins < WITHDRAW_MIN_SA) {
        document.getElementById('withdrawStatus').textContent = `Need at least ${WITHDRAW_MIN_SA} SA to withdraw.`;
        document.getElementById('withdrawStatus').classList.add('error-message');
        return;
    }

    // Clear status
    document.getElementById('withdrawStatus').textContent = "";
    document.getElementById('withdrawStatus').classList.remove('error-message');

    // Check wallet connection
    if(typeof window.ethereum === 'undefined') {
        document.getElementById('withdrawStatus').textContent = "Please connect a BNB wallet first.";
        document.getElementById('withdrawStatus').classList.add('error-message');
        return;
    }

    // Check if user has paid eligibility fee
    const { data: withdrawals, error } = await supabase
        .from('withdrawals')
        .select('*')
        .eq('user_id', supabaseUserId)
        .neq('status', 'failed');
    
    const hasPaidEligibilityFee = withdrawals && withdrawals.length > 0;

    if (!hasPaidEligibilityFee) {
        const confirmed = confirm(`To withdraw, you need to pay a one-time eligibility fee of ${WITHDRAW_ELIGIBILITY_FEE_BNB} BNB.\n\nThis fee helps prevent abuse of the system.`);
        if (!confirmed) {
            document.getElementById('withdrawStatus').textContent = "Withdrawal cancelled";
            document.getElementById('withdrawStatus').classList.add('error-message');
            return;
        }

        // Process eligibility fee payment
        await processEligibilityFee();
    } else {
        processWithdrawal();
    }
};

// Process eligibility fee payment
async function processEligibilityFee() {
    try {
        document.getElementById('withdrawStatus').textContent = "Processing eligibility fee...";
        showNotification("Processing eligibility fee payment...", "info");

        // Show payment modal
        showPaymentModal('Processing Eligibility Fee', 'Please confirm the transaction in your wallet...');

        // 1. Create payment intent for eligibility fee
        const paymentIntent = await createPaymentIntent(
            `eligibility_fee_${Date.now()}`,
            WITHDRAW_ELIGIBILITY_FEE_BNB,
            'eligibility',
            {
                type: 'withdrawal_eligibility'
            }
        );

        // 2. Send BNB transaction
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();

        const gasPrice = await provider.getGasPrice();
        const gasLimit = 21000;

        const tx = {
            to: SUPREMEAMER_RECEIVER_BNB,
            value: ethers.utils.parseEther(WITHDRAW_ELIGIBILITY_FEE_BNB),
            gasLimit: gasLimit,
            gasPrice: gasPrice
        };

        // 3. Send transaction
        const transaction = await signer.sendTransaction(tx);
        
        // Update payment modal with transaction hash
        document.getElementById('transactionHash').textContent = transaction.hash;
        document.getElementById('paymentMessage').textContent = 'Transaction submitted! Waiting for confirmation...';
        
        showNotification(`Transaction sent! Hash: ${transaction.hash.substring(0, 10)}...`, "info");
        
        // 4. Verify payment
        const verification = await verifyPayment(paymentIntent.intentId, transaction.hash);
        
        if (verification.success) {
            document.getElementById('withdrawStatus').textContent = "";
            showNotification("Eligibility fee paid successfully!", "success");

            // Continue with withdrawal after eligibility
            processWithdrawal();
        } else {
            throw new Error('Eligibility fee payment verification failed');
        }
        
    } catch (error) {
        console.error("‚ùå Eligibility fee error:", error);
        hidePaymentModal();
        document.getElementById('withdrawStatus').textContent = "Eligibility fee failed: " + error.message;
        document.getElementById('withdrawStatus').classList.add('error-message');
        showNotification("Eligibility fee failed: " + error.message, "error");
    }
}

async function processWithdrawal() {
    // Calculate withdrawal with fee
    const feeAmount = minedCoins * (WITHDRAW_FEE_PERCENT / 100);
    const sendAmount = minedCoins - feeAmount;

    const confirmed = confirm(`Confirm withdrawal of ${minedCoins.toFixed(2)} SA?\n\nYou will receive: ${sendAmount.toFixed(2)} SA (${WITHDRAW_FEE_PERCENT}% fee)`);
    if (!confirmed) {
        document.getElementById('withdrawStatus').textContent = "Withdrawal cancelled";
        document.getElementById('withdrawStatus').classList.add('error-message');
        return;
    }

    try {
        // Show payment modal
        showPaymentModal('Processing Withdrawal', 'Please confirm the withdrawal transaction...');

        // 1. Create payment intent for withdrawal
        const paymentIntent = await createPaymentIntent(
            `withdrawal_${Date.now()}`,
            "0.001", // Small BNB fee for withdrawal processing
            'withdrawal',
            {
                amountSA: minedCoins,
                feeSA: feeAmount,
                receiveSA: sendAmount,
                withdrawalFeePercent: WITHDRAW_FEE_PERCENT
            }
        );

        // 2. Send BNB transaction
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        const signer = provider.getSigner();

        const gasPrice = await provider.getGasPrice();
        const gasLimit = 21000;

        const tx = {
            to: SUPREMEAMER_RECEIVER_BNB,
            value: ethers.utils.parseEther("0.001"),
            gasLimit: gasLimit,
            gasPrice: gasPrice
        };

        // 3. Send transaction
        const transaction = await signer.sendTransaction(tx);
        
        // Update payment modal with transaction hash
        document.getElementById('transactionHash').textContent = transaction.hash;
        document.getElementById('paymentMessage').textContent = 'Transaction submitted! Waiting for confirmation...';
        
        showNotification(`Transaction sent! Hash: ${transaction.hash.substring(0, 10)}...`, "info");
        
        // 4. Verify payment
        const verification = await verifyPayment(paymentIntent.intentId, transaction.hash);
        
        if (verification.success) {
            // 5. Update balances locally
            minedCoins = 0;
            saveUserMiningData();

            // 6. Store withdrawal record in Supabase
            const { error: withdrawalError } = await supabase
                .from('withdrawals')
                .insert({
                    user_id: supabaseUserId,
                    amount_sa: minedCoins,
                    amount_received: sendAmount,
                    fee_sa: feeAmount,
                    bnb_fee: "0.001",
                    email: currentUser.email,
                    tx_hash: transaction.hash,
                    status: 'processing',
                    requested_at: new Date().toISOString(),
                    wallet_address: (await window.ethereum.request({ method: 'eth_accounts' }))[0],
                    payment_intent_id: paymentIntent.intentId
                });

            if (withdrawalError) {
                console.error('Error saving withdrawal record:', withdrawalError);
            }

            // 7. Update UI
            updateUI();
            document.getElementById('withdrawStatus').textContent = "";

            // 8. Show success
            createConfetti();
            hidePaymentModal();
            showNotification(`Withdrawal successful! ${sendAmount.toFixed(2)} SA will be sent to your wallet.`, "success");

            alert(`Withdrawal completed!\n\nSent: ${sendAmount.toFixed(2)} SA\nFee: ${feeAmount.toFixed(2)} SA (${WITHDRAW_FEE_PERCENT}%)\n\nThank you for using SupremeAmer Coin!`);

        } else {
            throw new Error('Withdrawal payment verification failed');
        }

    } catch (error) {
        console.error("‚ùå Withdrawal error:", error);
        hidePaymentModal();
        document.getElementById('withdrawStatus').textContent = "Withdrawal failed: " + error.message;
        document.getElementById('withdrawStatus').classList.add('error-message');
        showNotification("Withdrawal failed: " + error.message, "error");
    }
}

// Timer click for claim
document.getElementById('timer').onclick = async function() {
    if (!currentUser) return;

    if (upgradeActive && miningUpgrade) {
        const now = Math.floor(Date.now() / 1000);
        const nextClaim = miningUpgrade.lastClaim + CLAIM_INTERVAL;

        if (now >= nextClaim) {
            // Calculate claimable amount
            const seconds = now - miningUpgrade.lastClaim;
            const claimAmount = seconds * miningUpgrade.upgradeSpeed;

            // Add to mined coins
            minedCoins += claimAmount;
            miningUpgrade.lastClaim = now;

            saveUserMiningData();

            updateUI();
            createConfetti();
            showNotification(`You claimed ${claimAmount.toFixed(4)} SA!`, "success");
        } else {
            const timeLeft = nextClaim - now;
            const days = Math.floor(timeLeft / (24 * 3600));
            const hours = Math.floor((timeLeft % (24 * 3600)) / 3600);

            showNotification(`Next claim available in ${days}d ${hours}h`, "info");
        }
    }
};

// Initialize app on page load
window.onload = function() {
    createParticles();
    initializeApp();
};

// Add periodic session check
setInterval(async () => {
    try {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session) {
            console.error("‚ùå Session expired, redirecting to login...");
            showNotification("Session expired, please login again", "error");
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 2000);
        }
    } catch (error) {
        console.error("‚ùå Session check failed:", error);
    }
}, 60000);
    </script>
</body>
</html>